---
{"dg-publish":true,"permalink":"/02.DevWiki/Sources/유니티 드로우콜과 배치/","noteIcon":""}
---

# 드로우콜 (Draw Call)과 배치 (Batching)

## 드로우콜(Draw Call)이란?
- **CPU가 GPU에게** 오브젝트를 그리라고 보내는 명령
- 드로우콜이 많아지면 왜 안좋은가?
	- 드로우콜 자체도 **CPU 비용**이 존재
	- 추가로 **CPU**와 **GPU**간의 통신양의 양이 많아지므로 커맨드 버퍼에서 **병목현상**이 발생하기 쉽다!

## 배치(Batching)란?
* **드로우콜 최적화 기법**
- **머테리얼이 같은 여러 개의 메시를 하나의 메시로**묶어, **단일 드로우콜**로 처리
- **드로우콜 수를 줄여 CPU의 부하를 감소**시킬 수 있다.
### 유니티의 배치 방식
### 정적 배치 (Static Batching)

> 동적 배치와 대비해 오브젝트를 움직이지 못하고 메모리를 많이 소모하는 대신 CPU 성능에서 이득을 챙기는 방식

- **조건**
    1. 인스펙터에서 오브젝트를 `Static`으로 설정.
	    * Static으로 설정한 오브젝트는 움직일 수 없게 된다
    2. **동일한 머티리얼**을 사용
- **장점**
    - 고정된 오브젝트들을 대상으로 하므로 매번 계산할 필요가 없음, **성능 우수**
- **단점**
    - 병합된 메시를 들고있기 위한 추가 메모리 필요, **메모리를 많이 차지**한다!
    - 런타임에 오브젝트 **이동 및 회전등 불가**
    - 메시 데이터가 빌드에 포함되어 **게임 용량이 증가**한다

### 동적 배치 (Dynamic Batching)

> 정적 배치와 대비해 오브젝트를 움직일 수 있고 메모리를 덜 소모하지만 CPU성능에서 불리함

- **조건**
	- **동일한 머티리얼** 사용, **900개 미만의 버텍스**
- **장점**:
    - **움직이는 오브젝트**에도 적용 가능
    - 별도 설정 없이 **자동으로 동작**
- **단점**
	- 매 프레임 오브젝트를 병합하기 위한 계산을 하므로 **CPU 부하** 큼

### GPU 인스턴싱 (GPU Instancing)
- **작동 방식**
	- **단일 드로우콜**로 동일한 메시를 여러 번 그린다
	- 각 인스턴스의 **트랜스폼과, 기타 정보들은 GPU로 보내 처리**
- **조건**
    - 머티리얼에서 `Enable GPU Instancing` 옵션을 활성화
    - 모든 인스턴스가 **동일한 메시와 머테리얼을 공유**해야 함
- **특징**
    - **효율적으로 수많은 동일 메시를 렌더링** 가능.
    - 인스턴스의 정보들을 GPU에서 처리한다는 점에서..
	    - **버텍스 수가 적은 메시**를 상대로는 **비효율**적일 수 있음
			- GPU가 연산할건 적은데 그걸 세팅해주는 과정이 더 비용을 많이 먹을수도 있기 때문임..
			- 유니티 공식 문서에 의하면 버텍스 수 256개가 기준이라고 함

### 스프라이트 아틀라스 (Sprite Atlas)

- **대상**: 2D 스프라이트 렌더링 (UI, 2D 게임 등).
- **작동 방식**
    - 여러 개의 스프라이트 텍스처를 하나의 큰 텍스처(아틀라스)로 묶는다.
    - `Sprite Packer` 또는 `Sprite Atlas` 애셋을 통해 생성.
- **주의사항**
    - 아틀라스에 포함된 스프라이트 중 하나만 필요해도 전체 아틀라스 텍스처를 메모리에 로드해야 함

### 관련 유니티 Docs
* 드로우콜 유니티 Docs
	* https://docs.unity3d.com/kr/2022.1/Manual/DrawCallBatching.html
* GPU 인스턴싱 유니티 Docs
	* https://docs.unity3d.com/kr/2022.1/Manual/GPUInstancing.html
